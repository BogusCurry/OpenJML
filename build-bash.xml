<project name="OpenJML" default="release-test" basedir=".">
	<description>
	</description>
	
	<target name="release-test" depends="release,test"/>
		
	<target name="release">
		<loadproperties srcFile="openjml.properties"/>
		<echo message="Building release"/>
		<chmod file="buildRelease" perm="ugo+x"/>
		<exec executable="${basedir}/buildRelease" 
			failonerror="true"
			osfamily="unix">
		</exec>
		<exec executable="bash" 
			failonerror="true"
			osfamily="windows">
			<arg value="${basedir}/buildRelease"/>
		</exec>
	</target>

	<target name="test">
		<echo message="Running tests ${openjml.localSetup} "/>
		<loadproperties srcFile="openjml.properties"/>
		<chmod file="releaseTests/runTests" perm="ugo+x"/>
		<chmod file="releaseTests/releaseTestHelper" perm="ugo+x"/>
		<exec executable="${basedir}/releaseTests/runTests" 
			osfamily="unix"
			failonerror="true">
			<env key="LOCAL_SETUP" value="${openjml.localSetup}"/>
		</exec>
		<exec executable="bash" 
			osfamily="windows"
			failonerror="true">
			<arg value="${basedir}/releaseTests/runTests"/>
			<env key="LOCAL_SETUP" value="${openjml.localSetup}"/>
		</exec>
	</target>

	<target name="clean">
		<delete dir="${basedir}/temp" />
		<delete dir="${basedir}/jars" />
		<delete>
			<fileset dir="." includes="openjml-*.tar.gz"/>
		</delete>
	</target>

</project>
